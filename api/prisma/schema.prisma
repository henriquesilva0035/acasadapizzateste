generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Table {
  id               Int     @id @default(autoincrement())
  label            String  @default("Mesa")
  status           String  @default("OPEN")
  customerName     String?
  waiterName       String?
  currentSessionId String?
  currentSessionCode String?
  orders           Order[]
}

model Order {
  idString        String      @id @default(uuid())
  customerId      Int?
  customer        Customer?   @relation(fields: [customerId], references: [id])
  customerName    String?
  waiterName      String?
  waiterId      Int?
  waiter        User?    @relation(fields: [waiterId], references: [id])
  customerPhone   String?
  customerAddress String?
  observation   String?
  tableId         Int?
  table           Table?      @relation(fields: [tableId], references: [id])
  tableSessionId  String?
  tableSessionCode String?
  total           Float
  deliveryFee     Float?
  canceledAt      DateTime?
  cancelReason    String?
  closedAt        DateTime?
  status          String      @default("PENDING")
  origin          String      @default("LOCAL")
  isTakeout       Boolean     @default(false)
  paymentMethod   String?
  createdAt       DateTime    @default(now())
  updatedAt DateTime @updatedAt
  items           OrderItem[]
  payments        OrderPayment[]
  syncedAt        DateTime?
}

// Pagamentos (para permitir m칰ltiplos meios e divis칚o)
model OrderPayment {
  id        Int      @id @default(autoincrement())
  orderId   String
  order     Order    @relation(fields: [orderId], references: [idString], onDelete: Cascade)
  method    String
  amount    Float
  createdAt DateTime @default(now())

  @@index([orderId])
  @@index([method])
}


model OrderItem {
  idString    String  @id @default(uuid())
  orderId     String
  order       Order   @relation(fields: [orderId], references: [idString], onDelete: Cascade)
  product     String
  quantity    Int
  price       Float
  category    String  @default("OUTROS")
  description String?
  customerName String?  // Nome do cliente dono deste item espec칤fico
  observation String?
  additions   String?
  

  // 游 CAMPOS DE PIZZA (alinhar com banco)
  flavors     String?
  border      String?
  extras      String?
  promoApplied String?
}



model Customer {
  id        Int      @id @default(autoincrement())
  phone     String   @unique
  name      String
  address   String?
  orders    Order[]
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

// --- ESTRUTURA NOVA DE PRODUTOS COM GRUPOS ---
model Product {
  id           Int                  @id @default(autoincrement())
  name         String
  description  String?
  price        Float
  promoPrice   Float?
  promoDays    String?  // NOVO: Ex: "1,2,3" (0=Dom, 1=Seg...)
  image        String
  category     String
  optionGroups ProductOptionGroup[] // Um produto tem v치rios grupos (ex: Carne, Molhos)
  categoryId   Int?     // Opcional por enquanto (para n칚o dar erro nos dados existentes)
  categoryRel  Category? @relation(fields: [categoryId], references: [id]) // O v칤nculo real
  available   Boolean @default(true)
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now())
  products  Product[]
}




model ProductOptionGroup {
  id        Int                 @id @default(autoincrement())
  productId Int
  product   Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  title     String // Ex: "Escolha a Carne", "Turbine seu lanche"
  min       Int                 @default(0) // 0 = Opcional, 1 = Obrigat칩rio
  max       Int                 @default(1) // 1 = S칩 um (Radio), >1 = V치rios (Checkbox)
  chargeMode String              @default("SUM") // SUM (somar), MAX (pegar maior), MIN (pegar menor)
  available Boolean              @default(true)
  items     ProductOptionItem[]
}

model ProductOptionItem {
  id          Int                @id @default(autoincrement())
  groupId     Int
  group       ProductOptionGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  name        String // Ex: "Carne de Sol", "Bacon"
  price       Float // Ex: 0.00 ou 3.00
  description String?
  imageUrl    String?
  available   Boolean            @default(true)
}

model User {
  id   Int    @id @default(autoincrement())
  name String
  pin  String @unique
 
  role  String  @default("WAITER") // "ADMIN" ou "WAITER"
  
  orders  Order[] // <--- ADICIONE ISSO (Lista de pedidos do gar칞om)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

// --- SISTEMA DE MARKETING E PROMO칂칏ES ---

model Promotion {
  id            Int      @id @default(autoincrement())
  name          String
  description   String?
  active        Boolean  @default(true)

  // Dias da semana (0=Dom,1=Seg...): "1,2,5"
  daysOfWeek    String

  // --- GATILHO (SE COMPRAR...) ---
  triggerCategory String?      // nome da categoria (opcional)
  triggerProductIds String?      // "1,2,3"
  triggerOptionItemIds String?   // "10,11"

  // --- RECOMPENSA (APLICA EM...) ---
  // ITEM_FREE | DISCOUNT_PERCENT | FIXED_PRICE | OPTION_FREE
  rewardType     String
  rewardCategory String?
  rewardProductIds String?       // "4,5"
  rewardOptionItemIds String?    // "20,21"


  discountPercent Float?
  fixedPrice      Float?

  // Quantidade m치xima que recebe a recompensa (ex: 1 gr치tis)
  maxRewardQty    Int     @default(1)

  // Exibir no card치pio
  showOnMenu      Boolean @default(true)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}




// Configura칞칫es Gerais da Loja (Banner, Avisos, etc)
model StoreSettings {
  id           Int     @id @default(autoincrement())
  bannerText   String? // Aquele texto que vai ficar passando
  bannerActive Boolean @default(true)
}


// --- SISTEMA DE ENTREGA POR BAIRRO ---
model Neighborhood {
  id        Int     @id @default(autoincrement())
  name      String  // Ex: "Centro"
  price     Float   // Ex: 5.00
  active    Boolean @default(true)
}